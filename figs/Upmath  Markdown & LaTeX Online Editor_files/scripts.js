function MarkdownParser(u){var e=this;u=u?"i":"";var c,d=null,p=null,i={},h={},l={},m={},f={},v={},g={};function w(e,t,n,r){var a=d;if(t in c){if(null===c[t])return void r.push({token:e,block:t,line:n});a=g[t]}if(void 0!==f[t]){var s=e.match(f[t]);s[2]&&(r.push({token:s[1],block:t+"-mark",line:n}),e=s[2],n=0)}for(var i,l=e.split(a),o=0;o<l.length;o++)""!=(i=l[o])&&(r.push({token:i,block:t,line:n}),n=0)}function k(e,t){for(var n in t)if(t.hasOwnProperty(n)&&t[n].test(e))return n;return""}return e.addInlineRules=function(e){var t,n,r=[];for(var a in e)if(e.hasOwnProperty(a)){var s=e[a].source;r.push(s),t=a,n=new RegExp("^("+s+")$",u),i[t]=n,l[t]=n}return d=new RegExp("("+r.join("|")+")",u),this},e.addSubRules=function(e){for(var t in c=e)if(e.hasOwnProperty(t)){var n=e[t],r=[];for(var a in n)if(n.hasOwnProperty(a)){var s=n[a].source;i=s,l=a,v[o=t]||(v[o]={}),v[o][l]=new RegExp("^("+i+")$",u),r.push(s)}g[t]=new RegExp("("+r.join("|")+")",u)}var i,l,o;return this},e.addBlockRules=function(e){var t,n,r=[];for(var a in e)if(e.hasOwnProperty(a)){var s=e[a].source;r.push(s),t=a,n=new RegExp("^("+s+")$",u),i[t]=n,h[t]=n}return p=new RegExp("("+r.join("|")+")",u),this},e.addRunIn=function(e){return m=e,this},e.addMarkers=function(e){return f=e,this},e.tokenize=function(e){var t,n,r=[],a=[],s=(e=e.replace("\r","")).split(p),i=s.length,l=0;for(t=0;t<i;t++)if(""!==s[t]){var o=k(s[t],h);if(0<l&&o in m){var u=m[o].allowedBlocks;if(u&&0<=u.indexOf(n)){s[l]+=s[t],s[t]="",a[t]="";continue}}n=a[l=t]=o}var c=0;for(t=0;t<i;t++){var d=s[t];if(""!==d){var f=0;"empty"!=a[t]&&(f=c,c=0),w(d,a[t],f,r),c+=substrCount("\n",d)}}return r},e.identifyInline=function(e){var t=e.block,n=l;if(t in c){if(null===c[t])return"";n=v[t]}return k(e.token,n)},e}!function(m,v){"use strict";var g={html:!0,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!0,typographer:!0,quotes:"\"\"''",_habr:{protocol:""},_highlight:!0,_strict:!1};function w(e){var t=m.body;["result-as-html","result-as-htmltex","result-as-habr","result-as-src","result-as-debug"].forEach(function(e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}),t.classList?t.classList.add("result-as-"+e):t.className+=" result-as-"+e}function k(e,n,t,r,a,s,i,l,o){var u=t(e).use(markdownitS2Tex).use(markdownitSub).use(markdownitSup),c=t(e).use(markdownitS2Tex).use(markdownitSub).use(markdownitSup),d=t(e).use(markdownitS2Tex,{noreplace:!0}).use(markdownitSub).use(markdownitSup),f=t(e).use(markdownitS2Tex,e._habr).use(markdownitSub).use(markdownitSup),p=t("zero").use(markdownitS2Tex);function h(e,t){if(0<=t&&e[t]&&e[t].children)for(var n=e[t].children.length;n--;)if("tex-block"===e[t].children[n].tag)return!0;return!1}u.renderer.rules.paragraph_open=u.renderer.rules.heading_open=function(e,t,n,r,a){var s;return e[t].map&&0===e[t].level&&(s=e[t].map[0],e[t].attrPush(["class","line"]),e[t].attrPush(["data-line",s+""])),h(e,t+1)&&(e[t].attrPush(["align","center"]),e[t].attrPush(["style","text-align: center;"])),a.renderToken(e,t,n,r,a)},c.renderer.rules.paragraph_open=c.renderer.rules.heading_open=function(e,t,n,r,a){return h(e,t+1)&&(e[t].attrPush(["align","center"]),e[t].attrPush(["style","text-align: center;"])),a.renderToken(e,t,n,r,a)},f.renderer.rules.heading_open=function(e,t,n,r,a){var s="";return 0<t&&"paragraph_close"===e[t-1].type&&!h(e,t-2)&&(s="\n"),s+a.renderToken(e,t,n,r,a)},f.renderer.rules.paragraph_open=function(e,t,n,r,a){var s="";return 0<t&&"paragraph_close"===e[t-1].type&&!h(e,t-2)&&(s="\n"),s},f.renderer.rules.paragraph_close=function(e,t,n,r,a){return"\n"},p.inline.ruler.before("backticks","backticks2",function(e,t){var n,r,a,s,i,l,o=e.pos;if(96!==e.src.charCodeAt(o))return!1;for(n=o,o++,r=e.posMax;o<r&&96===e.src.charCodeAt(o);)o++;for(a=e.src.slice(n,o),s=i=o;-1!==(s=e.src.indexOf("`",i));){for(i=s+1;i<r&&96===e.src.charCodeAt(i);)i++;if(i-s===a.length)return t||((l=e.push("backticks2_inline","code",0)).markup=a,l.content=e.src.slice(o,s)),e.pos=i,!0}return t||(e.pending+=a),e.pos+=a.length,!0}),p.renderer.rules.backticks2_inline=function(e,t){var n=e[t];return n.markup+n.content+n.markup},p.renderer.rules.text=function(e,t){return e[t].content},u.renderer.rules.math_inline=function(e,t){return n.getHtmlStub(e[t].content)},f.renderer.rules.math_number=function(e,t){return'<img align="right" src="//tex.s2cms.ru/svg/'+e[t].content+'" />'},f.renderer.rules.fence=function(e,t,n,r,a){var s,i=e[t],l=i.info?f.utils.unescapeAll(i.info).trim():"",o="";return l&&(o=l.split(/\s+/g)[0],i.attrPush(["lang",o])),s=n.highlight&&n.highlight(i.content,o)||f.utils.escapeHtml(i.content),"\n<source"+a.renderAttrs(i)+">"+s+"</source>\n"},this.getSource=a,this.setSource=function(e){s(e),this.updateResult()};var m=null,v="html";this.updateResult=function(){var e,t=a();m!==t&&(m=t,"html"===v?(n.reset(),i(u.render(t)),n.fixDom()):"htmltex"===v?l("result-src-content",'<script src="https://tex.s2cms.ru/latex.js"><\/script>\n'+d.render(t),"html"):"debug"===v?l("result-src-content",JSON.stringify(c.parse(t,{references:{}}),null,2),"json"):l("result-src-content","habr"===v?(e=t,f.render(e).replace("<spoiler ","\n<spoiler ")):"md"===v?p.renderInline(t):c.render(t),"html"),o(t))},this.getDisplayedResult=function(){var e=a();return"habr"===v?f.render(e):"htmltex"===v?'<script src="https://tex.s2cms.ru/latex.js"><\/script>\n'+d.render(e):"md"===v?p.renderInline(e):c.render(e)},this.getDisplayedResultFilename=function(){return v+".html"},r(v),this.switchView=function(e){r(v=e),m=null,this.updateResult()}}function x(e,t,n){var r=m.getElementsByClassName(e)[0];v.hljs?r.innerHTML=v.hljs.highlight(n,t).value:r.textContent=t}function S(e){m.getElementsByClassName("result-html")[0].innerHTML=e}function y(){for(var e,t=m.querySelectorAll(".result-html .line"),n=[],r=[0],a=[0],s=0,i=t.length;s<i;s++)(e=parseInt(t[s].getAttribute("data-line")))&&(n[e]=Math.round(t[s].offsetTop));var l=m.querySelectorAll(".ldt-pre .block-start");for(i=l.length,s=e=0;s<i;s++){var o=parseInt(l[s].getAttribute("data-line"));o&&void 0!==n[e+=o]&&(r.push(l[s].offsetTop),a.push(n[e]))}var u=m.querySelector(".ldt-pre").scrollHeight,c=r[r.length-1];return r.push(c<u-5?u-5:c),a.push(m.querySelector(".result-html").scrollHeight),[r,a]}documentReady(function(){var t=m.getElementById("editor-source"),n=m.getElementsByClassName("result-html")[0],r=debounce(function(){c.recalcHeight()},100),a=new ScrollMap(y),s=new k(g,new ImageLoader(new ImagePreloader,"https:"===location.protocol?"https:":"http:"),v.markdownit,w,function(){return t.value},function(e){t.value=e,c.update()},S,x,function(e){a.reset();try{localStorage.setItem("editor_content",e)}catch(e){}});s.updateResult();var i,e,l,o,u,c=new TextareaDecorator(t,mdParser),d=m.getElementsByClassName("source")[0],f=new SyncScroll(a,new Animator(function(){return d.scrollTop},function(e){d.scrollTop=e}),new Animator(function(){return n.scrollTop},function(e){n.scrollTop=e}),d,n,m.querySelector('[id^="container-block"]')),p=debounce(s.updateResult,300,{maxWait:3e3});function h(e){o.style.width="calc("+e+"% - 3px)",u.style.width="calc("+(100-e)+"% - 3px)",a.reset(),r()}t.addEventListener("keyup",p),t.addEventListener("paste",p),t.addEventListener("cut",p),t.addEventListener("mouseup",p),t.addEventListener("touchstart",f.switchScrollToSrc),t.addEventListener("mouseover",f.switchScrollToSrc),n.addEventListener("touchstart",f.switchScrollToResult),n.addEventListener("mouseover",f.switchScrollToResult),f.switchScrollToSrc(),Array.prototype.forEach.call(m.getElementsByClassName("control-item"),function(e,t){e.addEventListener("click",function(){var e=this.getAttribute("data-result-as");if(e&&(s.switchView(e),"preview"!==e)){var t=m.getElementsByClassName("result-src-content");t.length&&setTimeout(function(){selectText(t[0])},0)}})}),m.querySelector("._download-source").addEventListener("click",function(){var e=new Blob([s.getSource()],{type:"text/markdown;charset=utf-8"});saveAs(e,"source.md")}),m.querySelector("._download-result").addEventListener("click",function(){var e=new Blob([s.getDisplayedResult()],{type:"text/html;charset=utf-8"});saveAs(e,s.getDisplayedResultFilename())}),m.querySelector("._upload-source").addEventListener("click",function(){var e=m.getElementById("fileElem");(e.onclick||e.click||function(){}).call(e)}),m.getElementById("fileElem").addEventListener("change",function(){if(this.files&&FileReader){var e=new FileReader,t=this;e.onload=function(){s.setSource(this.result),t.value=t.defaultValue},e.readAsText(this.files[0])}}),e=m.querySelector(".slider"),l=new Draggabilly(e,{axis:"x"}),o=m.getElementById("source-block"),u=m.getElementById("result-block"),e.addEventListener("dblclick",function(){h(50)}),l.on("dragStart",function(e,t,n){i=v.innerWidth}),l.on("dragMove",function(e,t,n){h(100*t.pageX/i)}),v.addEventListener("resize",function(){a.reset(),r()})})}(document,window),function(){"use strict";function p(e,t){var n,r,a,s,i,l,o,u=e.pos,c=!0,d=!0,f=e.posMax,p=e.md.utils.isWhiteSpace,h=e.md.utils.isPunctChar,m=e.md.utils.isMdAsciiPunct;return n=0<t?e.src.charCodeAt(t-1):32,f<=u&&(c=!1),a=u-t,r=u<f?e.src.charCodeAt(u):32,i=m(n)||h(String.fromCharCode(n)),o=m(r)||h(String.fromCharCode(r)),s=p(n),(l=p(r))?c=!1:o&&(s||i||(c=!1)),s?d=!1:i&&(l||o||(d=!1)),{can_open:c,can_close:d,delims:a}}window.markdownitS2Tex=function(a,s){var d,f,i,l=(s="object"==typeof s?s:{}).inlineOpen||"$$",o=s.inlineClose||"$$",e=(d=l,f=o,function(e,t){var n,r,a,s,i=e.posMax,l=e.pos;if(e.src.slice(l,l+d.length)!==d)return!1;if(t)return!1;if(n=(a=p(e,l+d.length)).delims,!a.can_open)return e.pos+=n,e.pending+=e.src.slice(l,e.pos),!0;for(e.pos=l+d.length;e.pos<i;){if(e.src.slice(e.pos,e.pos+f.length)===f&&(a=p(e,e.pos+f.length)).can_close){r=!0;break}e.md.inline.skipToken(e)}if(!r)return e.pos=l,!1;var o=!1,u="tex-inline";if(0==l){var c=e.src.substring(e.pos+f.length);!(o=c.match(/^\s*(\([ \t]*\S+[ \t]*\))\s*$/))&&""!=c||(u="tex-block")}return o&&((s=e.push("math_number","tex-number",0)).content=o[1],s.markup="()"),e.posMax=e.pos,e.pos=l+f.length,(s=e.push("math_inline",u,0)).content=e.src.slice(e.pos,e.posMax),s.markup=d,e.pos=o?i:e.posMax+f.length,e.posMax=i,!0});a.inline.ruler.before("escape","math_inline",e),a.renderer.rules.math_inline=(i="https:"==location.protocol?"https:":"http:",i=void 0!==s.protocol?s.protocol:i,function(e,t){var n=e[t].content;if(s.noreplace)return(l+n+o).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");var r=i+"//tex.s2cms.ru/svg/"+encodeURIComponent(n);return"tex-inline"===e[t].tag?'<img src="'+r+'" alt="'+a.utils.escapeHtml(n)+'" />':'<img align="center" src="'+r+'" alt="'+a.utils.escapeHtml(n)+'" />'}),a.renderer.rules.math_number=function(e,t){return'<span style="float:right">'+e[t].content+"</span>"}}}();var mdParser=new MarkdownParser;function documentReady(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function findBisect(e,t){var n=0,r=t.length-1,a=t[n];if(e<=a)return{val:n,part:0};var s=t[r];if(s<e)return{val:r,part:0};for(;1<r-n;){var i=n+Math.round((r-n)/2),l=t[i];e<=l?(r=i,s=l):(n=i,a=l)}return{val:n,part:(e-a)/(s-a)}}function substrCount(e,t){for(var n=-1,r=-2;-1!=r;)n++,r=t.indexOf(e,r+1);return n}function selectText(e){if(window.getSelection){var t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}}function Animator(t,n){var r,s,i,l,a,o=0,u=0,c=0,d=0,f=null,p=function(e){null===f&&(f=e);var t=e-f;t<s?(o=c+i*(Math.cos(l*(t-s))-1),d=i*l*Math.sin(l*(s-t)),n(o),r=requestAnimationFrame(p),h&&(m(a,o),h=!1,f=e)):(f=null,d=0,n(c),cancelAnimationFrame(r),h=h&&!1)},h=!1;function m(e,t){var n;if(c=e,u=t,Math.abs(d)<1e-5)n=Math.PI,s=200;else{var r=(c-u)/d/200;n=r<0||.5<r?Math.PI*Math.sqrt(1-.5/r):.1;var a=(1-Math.cos(n))/n/Math.sin(n);s=(c-u)/a/d}l=n/s,i=(c-u)/(1-Math.cos(n))}this.setPos=function(e){(h=null!==f)?a=e:(m(e,o=t()),r=requestAnimationFrame(p))},this.stop=function(){f=null,d=0,cancelAnimationFrame(r),h=!1}}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ImagePreloader(){var s={},i=0;function a(){var e;e=200<=this.status&&this.status<400?this.responseText:'<svg height="24" version="1.1" width="24" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -1028.4)"><path d="m22 12c0 5.523-4.477 10-10 10-5.5228 0-10-4.477-10-10 0-5.5228 4.4772-10 10-10 5.523 0 10 4.4772 10 10z" fill="#742600" transform="translate(0 1029.4)"/><path d="m22 12c0 5.523-4.477 10-10 10-5.5228 0-10-4.477-10-10 0-5.5228 4.4772-10 10-10 5.523 0 10 4.4772 10 10z" fill="#AB562B" transform="translate(0 1028.4)"/><path d="m7.0503 1037.8 3.5357 3.6-3.5357 3.5 1.4142 1.4 3.5355-3.5 3.536 3.5 1.414-1.4-3.536-3.5 3.536-3.6-1.414-1.4-3.536 3.5-3.5355-3.5-1.4142 1.4z" fill="#742600"/><path d="m7.0503 1036.8 3.5357 3.6-3.5357 3.5 1.4142 1.4 3.5355-3.5 3.536 3.5 1.414-1.4-3.536-3.5 3.536-3.6-1.414-1.4-3.536 3.5-3.5355-3.5-1.4142 1.4z" fill="#ecf0f1"/></g></svg>',t(this.responseURL||this.s2Url,e)}this.onLoad=function(e,t){var n,r;s[e]?null!==s[e].svg&&t(e,s[e].svg,s[e].baseline):s[e]={svg:null,baseline:null,request:(n=e,(r=new XMLHttpRequest).open("GET",n,!0),r.s2Url=n,r.onload=a,r.onerror=function(){},r.send(),r),callback:t}};var t=function(e,t){var n=s[e];if(n){var r=(t=function(e){var t=e.match(/id=["']([^"']*)["']/g);if(!t)return e;for(var n,r,a,s=t.length;s--;)n=(a=t[s]).match(/id=["']([^"']*)["']/)[1],r="s"+i+n,e=e.replaceAll(a,'id="'+r+'"').replaceAll("#"+n,"#"+r);return i++,e}(t)).match(/postMessage\((?:&quot;|")([\d\|\.\-eE]*)(?:&quot;|")/);if(r)var a=r&&r[1]?r[1].split("|").shift():0;else a=null;n.callback(e,t,a),n.svg=t,n.baseline=a,n.request=null,n.callback=null}};this.getImageDataFromUrl=function(e){var t=s[e];return t||null}}function ImageLoader(n,r){var a=[],s=[],i={},l=0,d=null,o=null,u=null;this.reset=function(){a=[],l=0};function c(e,t,n){var r,a=i[e];if(a&&(r=a.length))for(;r--;){var s=a[r];f(s,t,n,s===o?"fade-in":"replace"),s===o&&(clearTimeout(d),u=o=null)}}function f(e,t,n,r){var a="s2tex_"+e,s=document.getElementById(a),i=s.parentNode,l="fade-out"==r?"0.5":"1",o='<svg class="svg-preview" id="'+a+'" ';o+=null===n?'width="13px" height="13px" ':'style="vertical-align:'+-n+'pt; opacity: 1" ';var u=document.createElement("div");u.innerHTML=t.replace("<svg ",o);var c=u.firstElementChild;u.removeChild(c),i.insertBefore(c,s),i.removeChild(s),"1"!=l&&(d=setTimeout(function(){document.getElementById(a).style.opacity=l},0))}this.getHtmlStub=function(e){a[l]=r+"//tex.s2cms.ru/svg/"+encodeURIComponent(e);var t='<span id="s2tex_'+l+'"></span>';return l++,t},this.fixDom=function(){!function(){if(l==s.length){for(var e,t=0,n=l;n--;)a[n]!=s[n]&&(t++,e=n);if(1==t){if(null===o)return u=s[o=e];if(o===e)return}}u=o=null}(),function(){i={};for(var e=l;e--;){var t=a[e];void 0===i[t]?i[t]=[e]:i[t].push(e)}}();for(var e=l;e--;)n.onLoad(a[e],c);if(null!==o){var t=n.getImageDataFromUrl(u);null!==t&&null===t.callback&&f(o,t.svg,t.baseline,"fade-out")}s=a.slice(0)}}function ScrollMap(u){var c=null;this.reset=function(){c=[null,null]},this.getPosition=function(e,t,n){var r=e.offsetHeight,a=e.scrollTop;if(0==a)return 0;null===c[t]&&(c=u());var s=c[t].length-1;if(c[t][s]<=a+r)return c[n][s]-r;var i=r/2,l=findBisect(a+i,c[t]),o=parseFloat(c[n][l.val]*(1-l.part));return c[n][l.val+1]&&(o+=parseFloat(c[n][l.val+1]*l.part)),o-i}}function SyncScroll(e,t,n,r,a,s){function i(){n.setPos(e.getPosition(r,0,1))}function l(){t.setPos(e.getPosition(a,1,0))}this.switchScrollToSrc=function(){a.removeEventListener("scroll",l),r.removeEventListener("scroll",i),r.addEventListener("scroll",i),s.id="container-block-source"},this.switchScrollToResult=function(){r.removeEventListener("scroll",i),a.removeEventListener("scroll",l),a.addEventListener("scroll",l),s.id="container-block-result"}}mdParser.addBlockRules({latexBlock:/[ \t]*\$\$\n?(?:[^\n]+\n)*(?:[^\n]*[^\\\n])?\$\$(?:[ \t]*\([ \t]*\S+[ \t]*\))?[ \t]*(?:\n|$)/,empty:/(?:[ \t]*\n)+/,fence:/```[\s\S]*?(?:$|```(?:\n|$))/,reference:/\[[^\]]+\]\:[^\n]*(?:\n|$)/,header:/#{1,6} [^\n]*(?:\n|$)/,header2:/[^\n]+\n[ \t]*[=-]{2,}(?:\n|$)/,rule:/(?:[\*]{3,}|[\-]{3,}|[\_]{3,})(?:\n|$)/,list:/[ ]{0,3}(?:[+\-\*]|\d+\.)[ \t]+[^\n]*(?:\n[ \t]*[^\n\t ]+[ \t]*)*(?:\n|$)/,quote:/[ ]{0,3}>[^\n]*(?:\n|$)/,paragraph:/[\s\S]*?(?:\n|$)/}).addInlineRules({latex:/\$\$(?:[\s\S]*?[^\\])?\$\$/,link:/\[.+?\][\(\[].*?[\)\]]/,bold:/(?:\s|^)__[\s\S]*?\S__|\*\*[\s\S]*?\S\*\*/,italic:/(?:\s|^)_[\s\S]*?[^\\\s]_|\*[^\\\s]\*|\*\S[\s\S]*?[^\\\s]\*/,strike:/~~.+?~~/,sup:/\^.+?\^/,sub:/~.+?~/,code:/``.+?``|`.*?[^`\\]`(?!`)/}).addSubRules({fence:null,rule:null,latexBlock:{comment:/%[^\n]*?(?=\$\$)|%[^\n]*/,reference:/[ \t]*\([ \t]*\S+[ \t]*\)[ \t\n]*$/,index:/(?:\^|_)(?:\\[a-zA-Zа-яА-я]+[\*]?(?:\{.*?\})|\{[a-zA-Zа-яА-я0-9]*?\}|[a-zA-Zа-яА-я0-9])/,bracket:/(?:(?:\\left|\\right)?[\{\}\[\]\(\)\|])/,keyword:/\\[a-zA-Zа-яА-я]+[\*]?/,keyword2:/\\[^a-zA-Zа-яА-я0-9]/,keyword3:/&/,delimeter:/\$\$/}}).addRunIn({paragraph:{allowedBlocks:["paragraph","quote","list"]}}).addMarkers({list:/^([ ]{0,3}(?:[+\-\*]|\d+\.)[ \t]+)([\s\S]*)$/,quote:/^([ ]{0,3}(?:>[ \t]*)+)([\s\S]*)$/}),String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(escapeRegExp(e),"g"),t)};var now=Date.now||function(){return(new Date).getTime()};function debounce(r,a,e){var s,i,l,o,u,c,d,f=0,p=!1,h=!1,m=!0;if("function"!=typeof r)throw new TypeError(FUNC_ERROR_TEXT);function t(e,t){t&&clearTimeout(t),i=c=d=void 0,e&&(f=now(),l=r.apply(u,s),c||i||(s=u=void 0))}function v(){var e=a-(now()-o);e<=0||a<e?t(d,i):c=setTimeout(v,e)}function g(){t(m,c)}function n(){if(s=arguments,o=now(),u=this,d=m&&(c||!p),!1===h)var e=p&&!c;else{i||p||(f=o);var t=h-(o-f),n=t<=0||h<t;n?(i=i&&clearTimeout(i),f=o,l=r.apply(u,s)):i=i||setTimeout(g,t)}return n&&c?c=clearTimeout(c):c||a===h||(c=setTimeout(v,a)),e&&(n=!0,l=r.apply(u,s)),!n||c||i||(s=u=void 0),l}return a=a<0?0:+a||0,"object"==typeof e&&(p=!!e.leading,h="maxWait"in e&&Math.max(+e.maxWait||0,a),m="trailing"in e?!!e.trailing:m),n.cancel=function(){c&&clearTimeout(c),i&&clearTimeout(i),i=c=d=void(f=0)},n}